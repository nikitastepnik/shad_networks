# Задание №1 - 50 баллов

Обсудим фрагментацию пакетов - How IP FRAGMENTATION Works https://www.youtube.com/watch?v=vdajb14Lcu0.

Как определить MTU по пути пакета при ситуации когда у нас несколько роутеров по пути и могут быть туннели и интерфейсы с отличным от нашего MTU? Может ли нам помочь do not fragment флаг?

Cможем ли мы фильтровать фрагментированный пакет фильтром не по IP адресам, а по номеру порта? Если да - то предложите решение.

Установите на какой-нибудь системе с Linux https://github.com/iovisor/bpftrace, напишите скрипт по аналогии с https://gist.github.com/akostrikov/6587d6de8714178d5ca5f8cda5134b17 который покажет kstack в момент когда система производит фрагментацию. Приложите вывод работы скрипта с информацией о kstack, достаточно информации о двух стеках. При этом нужно помнить что IPv4 и IPv6 могут фрагментировать пакеты разными функциями. Флаг -l у bpftrace поможет найти нужные функции.

Чтобы получить фрагментированный пакет можно воспользоваться ping. У него есть флаг для указания размера на многих системах (может быть он поможет определить MTU по пути пакета) -s packetsize Specify the number of data bytes to be sent. The default is 56, which translates into 64 ICMP data bytes when combined with the 8 bytes of ICMP header data. This option cannot be used with ping sweeps.
Задание №2 - 50 баллов

Часто при проверке работы систем можно надеяться на то что kill сэмулирует нам недоступность машины. То есть мы хотим проверить что система после отключения питания одного из серверов переживёт падение и сможет работать корректно дальше.

Ваша задача - предложить тест, который запустит два процесса (можно использовать netcat) для создания tcp сессии и убить один из процессов. Нужно понять - действительно ли система будет себя вести как при выключении по питанию и никаких пакетов не будет отправлено или же что-то отправит по tcp сессии. Посмотреть tcp сессию можно с помощью tcpdump. Опишите шаги по созданию сесси и результаты. Поможет ли отсылка SIGKILL/-9?

Почитать о подобных проблемах можно в Головоломках TCP https://habr.com/ru/companies/vk/articles/316128/
Задание №3 - 50 баллов

Необходимо изучить материалы по следующим ссылкам, необязательно глубоко углубляться в структуры данных ядра:

    https://blog.packagecloud.io/monitoring-tuning-linux-networking-stack-receiving-data/
    https://blog.packagecloud.io/monitoring-tuning-linux-networking-stack-sending-data/
    https://blog.packagecloud.io/illustrated-guide-monitoring-tuning-linux-networking-stack-receiving-data/
    https://blog.cloudflare.com/how-to-receive-a-million-packets/
    https://linux2me.wordpress.com/2018/06/03/tuning-the-tcp-stack-system-administrator/

Назовите и опишите три параметра, которые вы можете изменить с помощью ethtool и три параметра для sysctl.
Задание №4 - 50 баллов

Напишите код на Scapy c помощью которого можно сделать ARP poisoning для определённого адреса. Допустим, мы хотим чтобы сервер 10.0.0.2 думал что мы клиент 10.0.0.3 и отсылал фреймы L2 на наш мак адрес.

Наш IP адрес - 10.0.0.5.

Наш MAC адрес - F0:98:9D:00:00:01

MAC адрес сервера - F0:98:9D:00:00:02

MAC адрес клиента - F0:98:9D:00:00:03

Так же опишите как вы видите защиту от такого типа атак.
Задание №5 - 32 балла

В репозитории https://github.com/iovisor/bpftrace/tree/master/tools есть набор утилит для трейса функций ядра.

Выберите пять скриптов, которые вы сможете использовать для разбора сетевых проблем и опишите как бы вы их использовали.
