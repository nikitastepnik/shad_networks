sudo docker ps
CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS     NAMES
29c420d8897d   frrouting/frr:latest   "/sbin/tini -- /usr/…"   31 seconds ago   Up 30 seconds             clab-frrlab4-spine1
433fd109881f   frrouting/frr:latest   "/sbin/tini -- /usr/…"   31 seconds ago   Up 30 seconds             clab-frrlab4-spine2
387a29ee5a22   frrouting/frr:latest   "/sbin/tini -- /usr/…"   32 seconds ago   Up 31 seconds             clab-frrlab4-PC2
8e0a0801fd10   frrouting/frr:latest   "/sbin/tini -- /usr/…"   32 seconds ago   Up 31 seconds             clab-frrlab4-spine3
52488f53c2db   frrouting/frr:latest   "/sbin/tini -- /usr/…"   32 seconds ago   Up 31 seconds             clab-frrlab4-spine4
81b5a35c5066   frrouting/frr:latest   "/sbin/tini -- /usr/…"   32 seconds ago   Up 31 seconds             clab-frrlab4-PC1
ea71b2961a8b   frrouting/frr:latest   "/sbin/tini -- /usr/…"   32 seconds ago   Up 31 seconds             clab-frrlab4-leaf2
d6740866c0c9   frrouting/frr:latest   "/sbin/tini -- /usr/…"   32 seconds ago   Up 31 seconds             clab-frrlab4-leaf1


sudo docker exec -it clab-frrlab4-PC1 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname PC1
no ipv6 forwarding
!
interface eth1
 ip address 172.16.11.1/30
exit
!
interface lo
 ip address 10.0.254.7/32
exit
!
router bgp 65100
 bgp router-id 10.0.254.7
 neighbor eth1 interface remote-as external
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor eth1 route-map PERMIT_EBGP in
  neighbor eth1 route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-PC1 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:31
B>* 10.0.254.1/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 10.0.254.2/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 10.0.254.3/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 10.0.254.4/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 10.0.254.5/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 10.0.254.6/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:02
C>* 10.0.254.7/32 is directly connected, lo, 00:00:06
B>* 10.0.254.8/32 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:02
C>* 172.16.11.0/30 is directly connected, eth1, 00:00:06
B>* 172.16.22.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:02
B>* 172.16.111.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.112.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.113.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.114.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.221.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.222.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.223.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
B>* 172.16.224.0/30 [20/0] via 172.16.11.2, eth1, weight 1, 00:00:03
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:31


sudo docker exec -it clab-frrlab4-PC1 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=64 time=0.052 ms
64 bytes from 10.0.254.7: seq=1 ttl=64 time=0.047 ms
64 bytes from 10.0.254.7: seq=2 ttl=64 time=0.031 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.031/0.043/0.052 ms

sudo docker exec -it clab-frrlab4-PC1 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=61 time=0.099 ms
64 bytes from 10.0.254.8: seq=1 ttl=61 time=0.082 ms
64 bytes from 10.0.254.8: seq=2 ttl=61 time=0.076 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.076/0.085/0.099 ms




sudo docker exec -it clab-frrlab4-PC1 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  10.0.254.7 (10.0.254.7)  0.006 ms  0.003 ms  0.002 ms

sudo docker exec -it clab-frrlab4-PC1 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  172.16.11.2 (172.16.11.2)  0.004 ms  0.003 ms  0.004 ms
 2  172.16.111.1 (172.16.111.1)  0.001 ms  0.002 ms  0.002 ms
 3  172.16.221.2 (172.16.221.2)  0.002 ms  0.004 ms  0.003 ms
 4  10.0.254.8 (10.0.254.8)  0.002 ms  0.003 ms  0.002 ms




sudo docker exec -it clab-frrlab4-PC1 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.7, local AS number 65100 vrf-id 0
BGP table version 18
RIB entries 35, using 6720 bytes of memory
Peers 1, using 717 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65001        65        45        0    0    0 00:00:09           17       18 N/A

Total number of neighbors 1


sudo docker exec -it clab-frrlab4-PC1 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.11.2, remote AS 65001, local AS 65100, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf1
  BGP version 4, remote router ID 10.0.254.5, local router ID 10.0.254.7
  BGP state = Established, up for 00:00:09
  Last read 00:00:03, Last write 00:00:03
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 180 seconds, keepalive interval is 60 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: PC1,domain name: n/a) received (name: leaf1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               38         58
    Keepalives:             3          3
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 45         65
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  17 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:10,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.11.1, Local port: 52734
Foreign host: 172.16.11.2, Foreign port: 179
Nexthop: 172.16.11.1
Nexthop global: fe80::a8c1:abff:fe74:4c77
Nexthop local: fe80::a8c1:abff:fe74:4c77
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 120
Estimated round trip time: 4 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-PC1 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 18, local router ID is 10.0.254.7, vrf id 0
Default local pref 100, local AS 65100
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*> 10.0.254.1/32    172.16.11.2                            0 65001 65000 ?
*> 10.0.254.2/32    172.16.11.2                            0 65001 65000 ?
*> 10.0.254.3/32    172.16.11.2                            0 65001 65200 ?
*> 10.0.254.4/32    172.16.11.2                            0 65001 65200 ?
*> 10.0.254.5/32    172.16.11.2              0             0 65001 ?
*> 10.0.254.6/32    172.16.11.2                            0 65001 65000 65002 ?
*> 10.0.254.7/32    0.0.0.0                  0         32768 ?
*> 10.0.254.8/32    172.16.11.2                            0 65001 65000 65002 65101 ?
*  172.16.11.0/30   172.16.11.2              0             0 65001 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.22.0/30   172.16.11.2                            0 65001 65000 65002 ?
*> 172.16.111.0/30  172.16.11.2              0             0 65001 ?
*> 172.16.112.0/30  172.16.11.2              0             0 65001 ?
*> 172.16.113.0/30  172.16.11.2              0             0 65001 ?
*> 172.16.114.0/30  172.16.11.2              0             0 65001 ?
*> 172.16.221.0/30  172.16.11.2                            0 65001 65000 ?
*> 172.16.222.0/30  172.16.11.2                            0 65001 65000 ?
*> 172.16.223.0/30  172.16.11.2                            0 65001 65200 ?
*> 172.16.224.0/30  172.16.11.2                            0 65001 65200 ?

Displayed  18 routes and 19 total paths


sudo docker exec -it clab-frrlab4-PC1 vtysh -c "sh ip bgp 10.0.254.6"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP routing table entry for 10.0.254.6/32, version 16
Paths: (1 available, best #1, table default)
  Advertised to non peer-group peers:
  eth1
  65001 65000 65002
    172.16.11.2 from eth1 (10.0.254.5)
      Origin incomplete, valid, external, best (First path received)
      Last update: Sat May 18 18:18:11 2024


sudo docker exec -it clab-frrlab4-PC2 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname PC2
no ipv6 forwarding
!
interface eth1
 ip address 172.16.22.1/30
exit
!
interface lo
 ip address 10.0.254.8/32
exit
!
router bgp 65101
 bgp router-id 10.0.254.8
 neighbor eth1 interface remote-as external
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor eth1 route-map PERMIT_EBGP in
  neighbor eth1 route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-PC2 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:36
B>* 10.0.254.1/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 10.0.254.2/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 10.0.254.3/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 10.0.254.4/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 10.0.254.5/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:07
B>* 10.0.254.6/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 10.0.254.7/32 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:07
C>* 10.0.254.8/32 is directly connected, lo, 00:00:11
B>* 172.16.11.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:07
C>* 172.16.22.0/30 is directly connected, eth1, 00:00:11
B>* 172.16.111.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.112.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.113.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.114.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.221.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.222.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.223.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
B>* 172.16.224.0/30 [20/0] via 172.16.22.2, eth1, weight 1, 00:00:08
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:36


sudo docker exec -it clab-frrlab4-PC2 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=61 time=0.097 ms
64 bytes from 10.0.254.7: seq=1 ttl=61 time=0.074 ms
64 bytes from 10.0.254.7: seq=2 ttl=61 time=0.066 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.066/0.079/0.097 ms

sudo docker exec -it clab-frrlab4-PC2 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=64 time=0.042 ms
64 bytes from 10.0.254.8: seq=1 ttl=64 time=0.034 ms
64 bytes from 10.0.254.8: seq=2 ttl=64 time=0.046 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.034/0.040/0.046 ms




sudo docker exec -it clab-frrlab4-PC2 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  172.16.22.2 (172.16.22.2)  0.005 ms  0.005 ms  0.004 ms
 2  172.16.224.1 (172.16.224.1)  0.002 ms  0.004 ms  0.002 ms
 3  172.16.114.2 (172.16.114.2)  0.002 ms  0.003 ms  0.002 ms
 4  10.0.254.7 (10.0.254.7)  0.001 ms  0.004 ms  0.003 ms

sudo docker exec -it clab-frrlab4-PC2 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  10.0.254.8 (10.0.254.8)  0.004 ms  0.004 ms  0.002 ms




sudo docker exec -it clab-frrlab4-PC2 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.8, local AS number 65101 vrf-id 0
BGP table version 18
RIB entries 35, using 6720 bytes of memory
Peers 1, using 717 KiB of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65002        67        47        0    0    0 00:00:13           17       18 N/A

Total number of neighbors 1


sudo docker exec -it clab-frrlab4-PC2 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.22.2, remote AS 65002, local AS 65101, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf2
  BGP version 4, remote router ID 10.0.254.6, local router ID 10.0.254.8
  BGP state = Established, up for 00:00:13
  Last read 00:00:01, Last write 00:00:01
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 180 seconds, keepalive interval is 60 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: PC2,domain name: n/a) received (name: leaf2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               38         58
    Keepalives:             5          5
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 47         67
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  17 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:14,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.22.1, Local port: 54304
Foreign host: 172.16.22.2, Foreign port: 179
Nexthop: 172.16.22.1
Nexthop global: fe80::a8c1:abff:fef4:a0a0
Nexthop local: fe80::a8c1:abff:fef4:a0a0
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 120
Estimated round trip time: 4 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-PC2 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 18, local router ID is 10.0.254.8, vrf id 0
Default local pref 100, local AS 65101
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*> 10.0.254.1/32    172.16.22.2                            0 65002 65000 ?
*> 10.0.254.2/32    172.16.22.2                            0 65002 65000 ?
*> 10.0.254.3/32    172.16.22.2                            0 65002 65200 ?
*> 10.0.254.4/32    172.16.22.2                            0 65002 65200 ?
*> 10.0.254.5/32    172.16.22.2                            0 65002 65000 65001 ?
*> 10.0.254.6/32    172.16.22.2              0             0 65002 ?
*> 10.0.254.7/32    172.16.22.2                            0 65002 65000 65001 65100 ?
*> 10.0.254.8/32    0.0.0.0                  0         32768 ?
*> 172.16.11.0/30   172.16.22.2                            0 65002 65000 65001 ?
*  172.16.22.0/30   172.16.22.2              0             0 65002 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.111.0/30  172.16.22.2                            0 65002 65000 ?
*> 172.16.112.0/30  172.16.22.2                            0 65002 65000 ?
*> 172.16.113.0/30  172.16.22.2                            0 65002 65200 ?
*> 172.16.114.0/30  172.16.22.2                            0 65002 65200 ?
*> 172.16.221.0/30  172.16.22.2              0             0 65002 ?
*> 172.16.222.0/30  172.16.22.2              0             0 65002 ?
*> 172.16.223.0/30  172.16.22.2              0             0 65002 ?
*> 172.16.224.0/30  172.16.22.2              0             0 65002 ?

Displayed  18 routes and 19 total paths


sudo docker exec -it clab-frrlab4-PC2 vtysh -c "sh ip bgp 10.0.254.5"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP routing table entry for 10.0.254.5/32, version 16
Paths: (1 available, best #1, table default)
  Advertised to non peer-group peers:
  eth1
  65002 65000 65001
    172.16.22.2 from eth1 (10.0.254.6)
      Origin incomplete, valid, external, best (First path received)
      Last update: Sat May 18 18:18:11 2024


sudo docker exec -it clab-frrlab4-leaf1 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname leaf1
no ipv6 forwarding
!
interface eth1
 ip address 172.16.112.2/30
exit
!
interface eth2
 ip address 172.16.111.2/30
exit
!
interface eth3
 ip address 172.16.11.2/30
exit
!
interface eth4
 ip address 172.16.113.2/30
exit
!
interface eth5
 ip address 172.16.114.2/30
exit
!
interface lo
 ip address 10.0.254.5/32
exit
!
router bgp 65001
 bgp router-id 10.0.254.5
 bgp bestpath as-path multipath-relax
 timers bgp 3 9
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC advertisement-interval 0
 neighbor FABRIC timers connect 5
 neighbor eth1 interface peer-group FABRIC
 neighbor eth2 interface peer-group FABRIC
 neighbor eth4 interface peer-group FABRIC
 neighbor eth5 interface peer-group FABRIC
 neighbor eth3 interface remote-as external
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor FABRIC route-map PERMIT_EBGP in
  neighbor FABRIC route-map PERMIT_EBGP out
  neighbor eth3 route-map PERMIT_EBGP in
  neighbor eth3 route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-leaf1 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:40
B>* 10.0.254.1/32 [20/0] via 172.16.111.1, eth2, weight 1, 00:00:13
B>* 10.0.254.2/32 [20/0] via 172.16.112.1, eth1, weight 1, 00:00:13
B>* 10.0.254.3/32 [20/0] via 172.16.113.1, eth4, weight 1, 00:00:13
B>* 10.0.254.4/32 [20/0] via 172.16.114.1, eth5, weight 1, 00:00:13
C>* 10.0.254.5/32 is directly connected, lo, 00:00:16
B>* 10.0.254.6/32 [20/0] via 172.16.111.1, eth2, weight 1, 00:00:12
  *                      via 172.16.112.1, eth1, weight 1, 00:00:12
  *                      via 172.16.113.1, eth4, weight 1, 00:00:12
  *                      via 172.16.114.1, eth5, weight 1, 00:00:12
B>* 10.0.254.7/32 [20/0] via 172.16.11.1, eth3, weight 1, 00:00:13
B>* 10.0.254.8/32 [20/0] via 172.16.111.1, eth2, weight 1, 00:00:12
  *                      via 172.16.112.1, eth1, weight 1, 00:00:12
  *                      via 172.16.113.1, eth4, weight 1, 00:00:12
  *                      via 172.16.114.1, eth5, weight 1, 00:00:12
C>* 172.16.11.0/30 is directly connected, eth3, 00:00:16
B>* 172.16.22.0/30 [20/0] via 172.16.111.1, eth2, weight 1, 00:00:12
  *                       via 172.16.112.1, eth1, weight 1, 00:00:12
  *                       via 172.16.113.1, eth4, weight 1, 00:00:12
  *                       via 172.16.114.1, eth5, weight 1, 00:00:12
C>* 172.16.111.0/30 is directly connected, eth2, 00:00:16
C>* 172.16.112.0/30 is directly connected, eth1, 00:00:16
C>* 172.16.113.0/30 is directly connected, eth4, 00:00:16
C>* 172.16.114.0/30 is directly connected, eth5, 00:00:16
B>* 172.16.221.0/30 [20/0] via 172.16.111.1, eth2, weight 1, 00:00:13
B>* 172.16.222.0/30 [20/0] via 172.16.112.1, eth1, weight 1, 00:00:13
B>* 172.16.223.0/30 [20/0] via 172.16.113.1, eth4, weight 1, 00:00:13
B>* 172.16.224.0/30 [20/0] via 172.16.114.1, eth5, weight 1, 00:00:13
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:41


sudo docker exec -it clab-frrlab4-leaf1 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=64 time=0.067 ms
64 bytes from 10.0.254.7: seq=1 ttl=64 time=0.065 ms
64 bytes from 10.0.254.7: seq=2 ttl=64 time=0.057 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.057/0.063/0.067 ms

sudo docker exec -it clab-frrlab4-leaf1 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=62 time=0.091 ms
64 bytes from 10.0.254.8: seq=1 ttl=62 time=0.070 ms
64 bytes from 10.0.254.8: seq=2 ttl=62 time=0.065 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.065/0.075/0.091 ms




sudo docker exec -it clab-frrlab4-leaf1 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  10.0.254.7 (10.0.254.7)  0.005 ms  0.004 ms  0.005 ms

sudo docker exec -it clab-frrlab4-leaf1 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  172.16.114.1 (172.16.114.1)  0.005 ms  0.004 ms  0.002 ms
 2  172.16.223.2 (172.16.223.2)  0.002 ms  0.003 ms  0.002 ms
 3  10.0.254.8 (10.0.254.8)  0.002 ms  0.003 ms  0.005 ms




sudo docker exec -it clab-frrlab4-leaf1 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.5, local AS number 65001 vrf-id 0
BGP table version 18
RIB entries 35, using 6720 bytes of memory
Peers 5, using 3585 KiB of memory
Peer groups 1, using 64 bytes of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65000        43        57        0    0    0 00:00:18            9       18 N/A
eth2            4      65000        43        57        0    0    0 00:00:18            9       18 N/A
eth4            4      65200        43        57        0    0    0 00:00:18            9       18 N/A
eth5            4      65200        43        57        0    0    0 00:00:17            9       18 N/A
eth3            4      65100        49        69        0    0    0 00:00:18            2       18 N/A

Total number of neighbors 5


sudo docker exec -it clab-frrlab4-leaf1 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.112.1, remote AS 65000, local AS 65001, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine2
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.2, local router ID 10.0.254.5
  BGP state = Established, up for 00:00:18
  Last read 00:00:03, Last write 00:00:03
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf1,domain name: n/a) received (name: spine2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               47         33
    Keepalives:             6          6
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 57         43
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  9 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:19,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.112.2, Local port: 41764
Foreign host: 172.16.112.1, Foreign port: 179
Nexthop: 172.16.112.2
Nexthop global: fe80::a8c1:abff:fee7:2105
Nexthop local: fe80::a8c1:abff:fee7:2105
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 7 ms
Read thread: on  Write thread: on  FD used: 27

BGP neighbor on eth2: 172.16.111.1, remote AS 65000, local AS 65001, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine1
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.1, local router ID 10.0.254.5
  BGP state = Established, up for 00:00:18
  Last read 00:00:00, Last write 00:00:00
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf1,domain name: n/a) received (name: spine1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               47         33
    Keepalives:             7          7
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 58         44
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  9 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:19,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.111.2, Local port: 39690
Foreign host: 172.16.111.1, Foreign port: 179
Nexthop: 172.16.111.2
Nexthop global: fe80::a8c1:abff:fe1a:aff
Nexthop local: fe80::a8c1:abff:fe1a:aff
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 7 ms
Read thread: on  Write thread: on  FD used: 25

BGP neighbor on eth4: 172.16.113.1, remote AS 65200, local AS 65001, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine3
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.3, local router ID 10.0.254.5
  BGP state = Established, up for 00:00:18
  Last read 00:00:00, Last write 00:00:00
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf1,domain name: n/a) received (name: spine3,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               47         33
    Keepalives:             7          7
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 58         44
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  9 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:19,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.113.2, Local port: 40084
Foreign host: 172.16.113.1, Foreign port: 179
Nexthop: 172.16.113.2
Nexthop global: fe80::a8c1:abff:fee9:2b04
Nexthop local: fe80::a8c1:abff:fee9:2b04
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 7 ms
Read thread: on  Write thread: on  FD used: 26

BGP neighbor on eth5: 172.16.114.1, remote AS 65200, local AS 65001, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine4
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.4, local router ID 10.0.254.5
  BGP state = Established, up for 00:00:17
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf1,domain name: n/a) received (name: spine4,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               47         33
    Keepalives:             6          6
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 57         43
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  9 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:19,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.114.2, Local port: 33514
Foreign host: 172.16.114.1, Foreign port: 179
Nexthop: 172.16.114.2
Nexthop global: fe80::a8c1:abff:fec3:6b51
Nexthop local: fe80::a8c1:abff:fec3:6b51
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 7 ms
Read thread: on  Write thread: on  FD used: 28

BGP neighbor on eth3: 172.16.11.1, remote AS 65100, local AS 65001, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: PC1
  BGP version 4, remote router ID 10.0.254.7, local router ID 10.0.254.5
  BGP state = Established, up for 00:00:18
  Last read 00:00:00, Last write 00:00:00
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf1,domain name: n/a) received (name: PC1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               58         38
    Keepalives:             7          7
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 69         49
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  2 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:19,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.11.2, Local port: 179
Foreign host: 172.16.11.1, Foreign port: 52734
Nexthop: 172.16.11.2
Nexthop global: fe80::a8c1:abff:fe74:1d7c
Nexthop local: fe80::a8c1:abff:fe74:1d7c
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 120
Estimated round trip time: 3 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-leaf1 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 18, local router ID is 10.0.254.5, vrf id 0
Default local pref 100, local AS 65001
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*> 10.0.254.1/32    172.16.111.1             0             0 65000 ?
*> 10.0.254.2/32    172.16.112.1             0             0 65000 ?
*> 10.0.254.3/32    172.16.113.1             0             0 65200 ?
*> 10.0.254.4/32    172.16.114.1             0             0 65200 ?
*> 10.0.254.5/32    0.0.0.0                  0         32768 ?
*> 10.0.254.6/32    172.16.111.1                           0 65000 65002 ?
*=                  172.16.112.1                           0 65000 65002 ?
*=                  172.16.114.1                           0 65200 65002 ?
*=                  172.16.113.1                           0 65200 65002 ?
*> 10.0.254.7/32    172.16.11.1              0             0 65100 ?
*> 10.0.254.8/32    172.16.111.1                           0 65000 65002 65101 ?
*=                  172.16.112.1                           0 65000 65002 65101 ?
*=                  172.16.114.1                           0 65200 65002 65101 ?
*=                  172.16.113.1                           0 65200 65002 65101 ?
*  172.16.11.0/30   172.16.11.1              0             0 65100 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.22.0/30   172.16.111.1                           0 65000 65002 ?
*=                  172.16.112.1                           0 65000 65002 ?
*=                  172.16.114.1                           0 65200 65002 ?
*=                  172.16.113.1                           0 65200 65002 ?
*  172.16.111.0/30  172.16.111.1             0             0 65000 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.112.0/30  172.16.112.1             0             0 65000 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.113.0/30  172.16.113.1             0             0 65200 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.114.0/30  172.16.114.1             0             0 65200 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.221.0/30  172.16.112.1                           0 65000 65002 ?
*                   172.16.114.1                           0 65200 65002 ?
*                   172.16.113.1                           0 65200 65002 ?
*>                  172.16.111.1             0             0 65000 ?
*  172.16.222.0/30  172.16.111.1                           0 65000 65002 ?
*                   172.16.114.1                           0 65200 65002 ?
*                   172.16.113.1                           0 65200 65002 ?
*>                  172.16.112.1             0             0 65000 ?
*  172.16.223.0/30  172.16.111.1                           0 65000 65002 ?
*                   172.16.112.1                           0 65000 65002 ?
*                   172.16.114.1                           0 65200 65002 ?
*>                  172.16.113.1             0             0 65200 ?
*  172.16.224.0/30  172.16.111.1                           0 65000 65002 ?
*                   172.16.112.1                           0 65000 65002 ?
*                   172.16.113.1                           0 65200 65002 ?
*>                  172.16.114.1             0             0 65200 ?

Displayed  18 routes and 44 total paths


sudo docker exec -it clab-frrlab4-leaf2 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname leaf2
no ipv6 forwarding
!
interface eth1
 ip address 172.16.221.2/30
exit
!
interface eth2
 ip address 172.16.222.2/30
exit
!
interface eth3
 ip address 172.16.22.2/30
exit
!
interface eth4
 ip address 172.16.223.2/30
exit
!
interface eth5
 ip address 172.16.224.2/30
exit
!
interface lo
 ip address 10.0.254.6/32
exit
!
router bgp 65002
 bgp router-id 10.0.254.6
 bgp bestpath as-path multipath-relax
 timers bgp 3 9
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC advertisement-interval 0
 neighbor FABRIC timers connect 5
 neighbor eth1 interface peer-group FABRIC
 neighbor eth2 interface peer-group FABRIC
 neighbor eth4 interface peer-group FABRIC
 neighbor eth5 interface peer-group FABRIC
 neighbor eth3 interface remote-as external
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor FABRIC route-map PERMIT_EBGP in
  neighbor FABRIC route-map PERMIT_EBGP out
  neighbor eth3 route-map PERMIT_EBGP in
  neighbor eth3 route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-leaf2 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:44
B>* 10.0.254.1/32 [20/0] via 172.16.221.1, eth1, weight 1, 00:00:17
B>* 10.0.254.2/32 [20/0] via 172.16.222.1, eth2, weight 1, 00:00:17
B>* 10.0.254.3/32 [20/0] via 172.16.223.1, eth4, weight 1, 00:00:17
B>* 10.0.254.4/32 [20/0] via 172.16.224.1, eth5, weight 1, 00:00:17
B>* 10.0.254.5/32 [20/0] via 172.16.221.1, eth1, weight 1, 00:00:17
  *                      via 172.16.222.1, eth2, weight 1, 00:00:17
  *                      via 172.16.223.1, eth4, weight 1, 00:00:17
  *                      via 172.16.224.1, eth5, weight 1, 00:00:17
C>* 10.0.254.6/32 is directly connected, lo, 00:00:20
B>* 10.0.254.7/32 [20/0] via 172.16.221.1, eth1, weight 1, 00:00:17
  *                      via 172.16.222.1, eth2, weight 1, 00:00:17
  *                      via 172.16.223.1, eth4, weight 1, 00:00:17
  *                      via 172.16.224.1, eth5, weight 1, 00:00:17
B>* 10.0.254.8/32 [20/0] via 172.16.22.1, eth3, weight 1, 00:00:17
B>* 172.16.11.0/30 [20/0] via 172.16.221.1, eth1, weight 1, 00:00:17
  *                       via 172.16.222.1, eth2, weight 1, 00:00:17
  *                       via 172.16.223.1, eth4, weight 1, 00:00:17
  *                       via 172.16.224.1, eth5, weight 1, 00:00:17
C>* 172.16.22.0/30 is directly connected, eth3, 00:00:20
B>* 172.16.111.0/30 [20/0] via 172.16.221.1, eth1, weight 1, 00:00:17
B>* 172.16.112.0/30 [20/0] via 172.16.222.1, eth2, weight 1, 00:00:17
B>* 172.16.113.0/30 [20/0] via 172.16.223.1, eth4, weight 1, 00:00:17
B>* 172.16.114.0/30 [20/0] via 172.16.224.1, eth5, weight 1, 00:00:17
C>* 172.16.221.0/30 is directly connected, eth1, 00:00:20
C>* 172.16.222.0/30 is directly connected, eth2, 00:00:20
C>* 172.16.223.0/30 is directly connected, eth4, 00:00:20
C>* 172.16.224.0/30 is directly connected, eth5, 00:00:20
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:44


sudo docker exec -it clab-frrlab4-leaf2 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=62 time=0.084 ms
64 bytes from 10.0.254.7: seq=1 ttl=62 time=0.071 ms
64 bytes from 10.0.254.7: seq=2 ttl=62 time=0.072 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.071/0.075/0.084 ms

sudo docker exec -it clab-frrlab4-leaf2 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=64 time=0.064 ms
64 bytes from 10.0.254.8: seq=1 ttl=64 time=0.064 ms
64 bytes from 10.0.254.8: seq=2 ttl=64 time=0.056 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.056/0.061/0.064 ms




sudo docker exec -it clab-frrlab4-leaf2 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  172.16.223.1 (172.16.223.1)  0.004 ms  0.003 ms  0.001 ms
 2  172.16.111.2 (172.16.111.2)  0.002 ms  0.002 ms  0.004 ms
 3  10.0.254.7 (10.0.254.7)  0.002 ms  0.001 ms  0.003 ms

sudo docker exec -it clab-frrlab4-leaf2 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  10.0.254.8 (10.0.254.8)  0.004 ms  0.003 ms  0.002 ms




sudo docker exec -it clab-frrlab4-leaf2 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.6, local AS number 65002 vrf-id 0
BGP table version 18
RIB entries 35, using 6720 bytes of memory
Peers 5, using 3585 KiB of memory
Peer groups 1, using 64 bytes of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65000        45        46        0    0    0 00:00:23           11       18 N/A
eth2            4      65000        45        46        0    0    0 00:00:23           11       18 N/A
eth4            4      65200        45        46        0    0    0 00:00:22           11       18 N/A
eth5            4      65200        45        46        0    0    0 00:00:23           11       18 N/A
eth3            4      65101        50        70        0    0    0 00:00:23            2       18 N/A

Total number of neighbors 5


sudo docker exec -it clab-frrlab4-leaf2 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.221.1, remote AS 65000, local AS 65002, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine1
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.1, local router ID 10.0.254.6
  BGP state = Established, up for 00:00:23
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf2,domain name: n/a) received (name: spine1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               34         33
    Keepalives:             8          8
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 46         45
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:24,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.221.2, Local port: 57050
Foreign host: 172.16.221.1, Foreign port: 179
Nexthop: 172.16.221.2
Nexthop global: fe80::a8c1:abff:fe31:ec88
Nexthop local: fe80::a8c1:abff:fe31:ec88
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 5 ms
Read thread: on  Write thread: on  FD used: 27

BGP neighbor on eth2: 172.16.222.1, remote AS 65000, local AS 65002, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine2
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.2, local router ID 10.0.254.6
  BGP state = Established, up for 00:00:23
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf2,domain name: n/a) received (name: spine2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               34         33
    Keepalives:             8          8
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 46         45
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:24,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.222.2, Local port: 53480
Foreign host: 172.16.222.1, Foreign port: 179
Nexthop: 172.16.222.2
Nexthop global: fe80::a8c1:abff:fe2c:ff0f
Nexthop local: fe80::a8c1:abff:fe2c:ff0f
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 5 ms
Read thread: on  Write thread: on  FD used: 25

BGP neighbor on eth4: 172.16.223.1, remote AS 65200, local AS 65002, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine3
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.3, local router ID 10.0.254.6
  BGP state = Established, up for 00:00:22
  Last read 00:00:01, Last write 00:00:01
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf2,domain name: n/a) received (name: spine3,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               34         33
    Keepalives:             8          8
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 46         45
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:24,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.223.2, Local port: 48970
Foreign host: 172.16.223.1, Foreign port: 179
Nexthop: 172.16.223.2
Nexthop global: fe80::a8c1:abff:febe:5478
Nexthop local: fe80::a8c1:abff:febe:5478
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 5 ms
Read thread: on  Write thread: on  FD used: 28

BGP neighbor on eth5: 172.16.224.1, remote AS 65200, local AS 65002, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: spine4
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.4, local router ID 10.0.254.6
  BGP state = Established, up for 00:00:23
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf2,domain name: n/a) received (name: spine4,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               34         33
    Keepalives:             8          8
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 46         45
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 2, subgroup 2
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:24,  Waiting for peer OPEN
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.224.2, Local port: 35644
Foreign host: 172.16.224.1, Foreign port: 179
Nexthop: 172.16.224.2
Nexthop global: fe80::a8c1:abff:fe39:9f9
Nexthop local: fe80::a8c1:abff:fe39:9f9
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 3 ms
Read thread: on  Write thread: on  FD used: 26

BGP neighbor on eth3: 172.16.22.1, remote AS 65101, local AS 65002, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: PC2
  BGP version 4, remote router ID 10.0.254.8, local router ID 10.0.254.6
  BGP state = Established, up for 00:00:23
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: leaf2,domain name: n/a) received (name: PC2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               58         38
    Keepalives:             8          8
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 70         50
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  2 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:24,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.22.2, Local port: 179
Foreign host: 172.16.22.1, Foreign port: 54304
Nexthop: 172.16.22.2
Nexthop global: fe80::a8c1:abff:fe09:1d3e
Nexthop local: fe80::a8c1:abff:fe09:1d3e
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 120
Estimated round trip time: 2 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-leaf2 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 18, local router ID is 10.0.254.6, vrf id 0
Default local pref 100, local AS 65002
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*  10.0.254.1/32    172.16.224.1                           0 65200 65001 65000 ?
*                   172.16.223.1                           0 65200 65001 65000 ?
*>                  172.16.221.1             0             0 65000 ?
*  10.0.254.2/32    172.16.224.1                           0 65200 65001 65000 ?
*                   172.16.223.1                           0 65200 65001 65000 ?
*>                  172.16.222.1             0             0 65000 ?
*  10.0.254.3/32    172.16.221.1                           0 65000 65001 65200 ?
*                   172.16.222.1                           0 65000 65001 65200 ?
*>                  172.16.223.1             0             0 65200 ?
*  10.0.254.4/32    172.16.221.1                           0 65000 65001 65200 ?
*                   172.16.222.1                           0 65000 65001 65200 ?
*>                  172.16.224.1             0             0 65200 ?
*> 10.0.254.5/32    172.16.221.1                           0 65000 65001 ?
*=                  172.16.224.1                           0 65200 65001 ?
*=                  172.16.222.1                           0 65000 65001 ?
*=                  172.16.223.1                           0 65200 65001 ?
*> 10.0.254.6/32    0.0.0.0                  0         32768 ?
*> 10.0.254.7/32    172.16.221.1                           0 65000 65001 65100 ?
*=                  172.16.224.1                           0 65200 65001 65100 ?
*=                  172.16.222.1                           0 65000 65001 65100 ?
*=                  172.16.223.1                           0 65200 65001 65100 ?
*> 10.0.254.8/32    172.16.22.1              0             0 65101 ?
*> 172.16.11.0/30   172.16.221.1                           0 65000 65001 ?
*=                  172.16.224.1                           0 65200 65001 ?
*=                  172.16.222.1                           0 65000 65001 ?
*=                  172.16.223.1                           0 65200 65001 ?
*  172.16.22.0/30   172.16.22.1              0             0 65101 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.111.0/30  172.16.224.1                           0 65200 65001 ?
*                   172.16.222.1                           0 65000 65001 ?
*                   172.16.223.1                           0 65200 65001 ?
*>                  172.16.221.1             0             0 65000 ?
*  172.16.112.0/30  172.16.221.1                           0 65000 65001 ?
*                   172.16.224.1                           0 65200 65001 ?
*                   172.16.223.1                           0 65200 65001 ?
*>                  172.16.222.1             0             0 65000 ?
*  172.16.113.0/30  172.16.221.1                           0 65000 65001 ?
*                   172.16.224.1                           0 65200 65001 ?
*                   172.16.222.1                           0 65000 65001 ?
*>                  172.16.223.1             0             0 65200 ?
*  172.16.114.0/30  172.16.221.1                           0 65000 65001 ?
*                   172.16.222.1                           0 65000 65001 ?
*                   172.16.223.1                           0 65200 65001 ?
*>                  172.16.224.1             0             0 65200 ?
*  172.16.221.0/30  172.16.221.1             0             0 65000 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.222.0/30  172.16.222.1             0             0 65000 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.223.0/30  172.16.223.1             0             0 65200 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.224.0/30  172.16.224.1             0             0 65200 ?
*>                  0.0.0.0                  0         32768 ?

Displayed  18 routes and 52 total paths


sudo docker exec -it clab-frrlab4-spine1 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname spine1
no ipv6 forwarding
!
interface eth1
 ip address 172.16.221.1/30
exit
!
interface eth2
 ip address 172.16.111.1/30
exit
!
interface lo
 ip address 10.0.254.1/32
exit
!
router bgp 65000
 bgp router-id 10.0.254.1
 bgp bestpath as-path multipath-relax
 timers bgp 3 9
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC advertisement-interval 0
 neighbor FABRIC timers connect 5
 neighbor eth1 interface peer-group FABRIC
 neighbor eth2 interface peer-group FABRIC
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor FABRIC route-map PERMIT_EBGP in
  neighbor FABRIC route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-spine1 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:49
C>* 10.0.254.1/32 is directly connected, lo, 00:00:25
B>* 10.0.254.3/32 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:21
  *                      via 172.16.221.2, eth1, weight 1, 00:00:21
B>* 10.0.254.4/32 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:21
  *                      via 172.16.221.2, eth1, weight 1, 00:00:21
B>* 10.0.254.5/32 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:22
B>* 10.0.254.6/32 [20/0] via 172.16.221.2, eth1, weight 1, 00:00:21
B>* 10.0.254.7/32 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:22
B>* 10.0.254.8/32 [20/0] via 172.16.221.2, eth1, weight 1, 00:00:21
B>* 172.16.11.0/30 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:22
B>* 172.16.22.0/30 [20/0] via 172.16.221.2, eth1, weight 1, 00:00:21
C>* 172.16.111.0/30 is directly connected, eth2, 00:00:25
B>* 172.16.112.0/30 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:22
B>* 172.16.113.0/30 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:22
B>* 172.16.114.0/30 [20/0] via 172.16.111.2, eth2, weight 1, 00:00:22
C>* 172.16.221.0/30 is directly connected, eth1, 00:00:25
B>* 172.16.222.0/30 [20/0] via 172.16.221.2, eth1, weight 1, 00:00:21
B>* 172.16.223.0/30 [20/0] via 172.16.221.2, eth1, weight 1, 00:00:21
B>* 172.16.224.0/30 [20/0] via 172.16.221.2, eth1, weight 1, 00:00:21
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:49


sudo docker exec -it clab-frrlab4-spine1 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=63 time=0.082 ms
64 bytes from 10.0.254.7: seq=1 ttl=63 time=0.062 ms
64 bytes from 10.0.254.7: seq=2 ttl=63 time=0.065 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.062/0.069/0.082 ms

sudo docker exec -it clab-frrlab4-spine1 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=63 time=0.074 ms
64 bytes from 10.0.254.8: seq=1 ttl=63 time=0.063 ms
64 bytes from 10.0.254.8: seq=2 ttl=63 time=0.049 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.049/0.062/0.074 ms




sudo docker exec -it clab-frrlab4-spine1 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  172.16.111.2 (172.16.111.2)  0.004 ms  0.004 ms  0.003 ms
 2  10.0.254.7 (10.0.254.7)  0.002 ms  0.003 ms  0.012 ms

sudo docker exec -it clab-frrlab4-spine1 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  172.16.221.2 (172.16.221.2)  0.004 ms  0.003 ms  0.002 ms
 2  10.0.254.8 (10.0.254.8)  0.001 ms  0.003 ms  0.003 ms




sudo docker exec -it clab-frrlab4-spine1 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.1, local AS number 65000 vrf-id 0
BGP table version 21
RIB entries 33, using 6336 bytes of memory
Peers 2, using 1434 KiB of memory
Peer groups 1, using 64 bytes of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65002        47        46        0    0    0 00:00:27           11       17 N/A
eth2            4      65001        61        47        0    0    0 00:00:27           11       17 N/A

Total number of neighbors 2


sudo docker exec -it clab-frrlab4-spine1 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.221.2, remote AS 65002, local AS 65000, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf2
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.6, local router ID 10.0.254.1
  BGP state = Established, up for 00:00:27
  Last read 00:00:03, Last write 00:00:03
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine1,domain name: n/a) received (name: leaf2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         34
    Keepalives:             9          9
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 46         47
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:28,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.221.1, Local port: 179
Foreign host: 172.16.221.2, Foreign port: 57050
Nexthop: 172.16.221.1
Nexthop global: fe80::a8c1:abff:feea:687a
Nexthop local: fe80::a8c1:abff:feea:687a
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 2 ms
Read thread: on  Write thread: on  FD used: 25

BGP neighbor on eth2: 172.16.111.2, remote AS 65001, local AS 65000, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf1
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.5, local router ID 10.0.254.1
  BGP state = Established, up for 00:00:27
  Last read 00:00:00, Last write 00:00:00
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine1,domain name: n/a) received (name: leaf1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         47
    Keepalives:            10         10
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 47         61
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:28,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.111.1, Local port: 179
Foreign host: 172.16.111.2, Foreign port: 39690
Nexthop: 172.16.111.1
Nexthop global: fe80::a8c1:abff:fe2b:c109
Nexthop local: fe80::a8c1:abff:fe2b:c109
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 4 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-spine1 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 21, local router ID is 10.0.254.1, vrf id 0
Default local pref 100, local AS 65000
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*> 10.0.254.1/32    0.0.0.0                  0         32768 ?
*= 10.0.254.3/32    172.16.221.2                           0 65002 65200 ?
*>                  172.16.111.2                           0 65001 65200 ?
*= 10.0.254.4/32    172.16.221.2                           0 65002 65200 ?
*>                  172.16.111.2                           0 65001 65200 ?
*> 10.0.254.5/32    172.16.111.2             0             0 65001 ?
*> 10.0.254.6/32    172.16.221.2             0             0 65002 ?
*> 10.0.254.7/32    172.16.111.2                           0 65001 65100 ?
*> 10.0.254.8/32    172.16.221.2                           0 65002 65101 ?
*> 172.16.11.0/30   172.16.111.2             0             0 65001 ?
*> 172.16.22.0/30   172.16.221.2             0             0 65002 ?
*  172.16.111.0/30  172.16.111.2             0             0 65001 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.112.0/30  172.16.111.2             0             0 65001 ?
*  172.16.113.0/30  172.16.221.2                           0 65002 65200 ?
*>                  172.16.111.2             0             0 65001 ?
*  172.16.114.0/30  172.16.221.2                           0 65002 65200 ?
*>                  172.16.111.2             0             0 65001 ?
*  172.16.221.0/30  172.16.221.2             0             0 65002 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.222.0/30  172.16.221.2             0             0 65002 ?
*> 172.16.223.0/30  172.16.221.2             0             0 65002 ?
*                   172.16.111.2                           0 65001 65200 ?
*> 172.16.224.0/30  172.16.221.2             0             0 65002 ?
*                   172.16.111.2                           0 65001 65200 ?

Displayed  17 routes and 25 total paths


sudo docker exec -it clab-frrlab4-spine2 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname spine2
no ipv6 forwarding
!
interface eth1
 ip address 172.16.112.1/30
exit
!
interface eth2
 ip address 172.16.222.1/30
exit
!
interface lo
 ip address 10.0.254.2/32
exit
!
router bgp 65000
 bgp router-id 10.0.254.2
 bgp bestpath as-path multipath-relax
 timers bgp 3 9
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC advertisement-interval 0
 neighbor FABRIC timers connect 5
 neighbor eth1 interface peer-group FABRIC
 neighbor eth2 interface peer-group FABRIC
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor FABRIC route-map PERMIT_EBGP in
  neighbor FABRIC route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-spine2 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:53
C>* 10.0.254.2/32 is directly connected, lo, 00:00:29
B>* 10.0.254.3/32 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:25
  *                      via 172.16.222.2, eth2, weight 1, 00:00:25
B>* 10.0.254.4/32 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:25
  *                      via 172.16.222.2, eth2, weight 1, 00:00:25
B>* 10.0.254.5/32 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:26
B>* 10.0.254.6/32 [20/0] via 172.16.222.2, eth2, weight 1, 00:00:25
B>* 10.0.254.7/32 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:26
B>* 10.0.254.8/32 [20/0] via 172.16.222.2, eth2, weight 1, 00:00:25
B>* 172.16.11.0/30 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:26
B>* 172.16.22.0/30 [20/0] via 172.16.222.2, eth2, weight 1, 00:00:25
B>* 172.16.111.0/30 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:26
C>* 172.16.112.0/30 is directly connected, eth1, 00:00:29
B>* 172.16.113.0/30 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:26
B>* 172.16.114.0/30 [20/0] via 172.16.112.2, eth1, weight 1, 00:00:26
B>* 172.16.221.0/30 [20/0] via 172.16.222.2, eth2, weight 1, 00:00:25
C>* 172.16.222.0/30 is directly connected, eth2, 00:00:29
B>* 172.16.223.0/30 [20/0] via 172.16.222.2, eth2, weight 1, 00:00:25
B>* 172.16.224.0/30 [20/0] via 172.16.222.2, eth2, weight 1, 00:00:25
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:53


sudo docker exec -it clab-frrlab4-spine2 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=63 time=0.067 ms
64 bytes from 10.0.254.7: seq=1 ttl=63 time=0.059 ms
64 bytes from 10.0.254.7: seq=2 ttl=63 time=0.076 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.059/0.067/0.076 ms

sudo docker exec -it clab-frrlab4-spine2 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=63 time=0.079 ms
64 bytes from 10.0.254.8: seq=1 ttl=63 time=0.052 ms
64 bytes from 10.0.254.8: seq=2 ttl=63 time=0.062 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.052/0.064/0.079 ms




sudo docker exec -it clab-frrlab4-spine2 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  172.16.112.2 (172.16.112.2)  0.005 ms  0.003 ms  0.002 ms
 2  10.0.254.7 (10.0.254.7)  0.002 ms  0.012 ms  0.002 ms

sudo docker exec -it clab-frrlab4-spine2 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  172.16.222.2 (172.16.222.2)  0.018 ms  0.003 ms  0.005 ms
 2  10.0.254.8 (10.0.254.8)  0.002 ms  0.003 ms  0.003 ms




sudo docker exec -it clab-frrlab4-spine2 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.2, local AS number 65000 vrf-id 0
BGP table version 21
RIB entries 33, using 6336 bytes of memory
Peers 2, using 1434 KiB of memory
Peer groups 1, using 64 bytes of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65001        62        50        0    0    0 00:00:32           11       17 N/A
eth2            4      65002        49        48        0    0    0 00:00:32           11       17 N/A

Total number of neighbors 2


sudo docker exec -it clab-frrlab4-spine2 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.112.2, remote AS 65001, local AS 65000, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf1
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.5, local router ID 10.0.254.2
  BGP state = Established, up for 00:00:32
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine2,domain name: n/a) received (name: leaf1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  2          1
    Notifications:          1          0
    Updates:               33         47
    Keepalives:            11         11
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 50         62
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:33,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.112.1, Local port: 179
Foreign host: 172.16.112.2, Foreign port: 41764
Nexthop: 172.16.112.1
Nexthop global: fe80::a8c1:abff:fefa:50a6
Nexthop local: fe80::a8c1:abff:fefa:50a6
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 4 ms
Read thread: on  Write thread: on  FD used: 25

BGP neighbor on eth2: 172.16.222.2, remote AS 65002, local AS 65000, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf2
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.6, local router ID 10.0.254.2
  BGP state = Established, up for 00:00:32
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine2,domain name: n/a) received (name: leaf2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         34
    Keepalives:            11         11
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 48         49
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  11 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:33,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.222.1, Local port: 179
Foreign host: 172.16.222.2, Foreign port: 53480
Nexthop: 172.16.222.1
Nexthop global: fe80::a8c1:abff:feb6:c175
Nexthop local: fe80::a8c1:abff:feb6:c175
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 2 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-spine2 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 21, local router ID is 10.0.254.2, vrf id 0
Default local pref 100, local AS 65000
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*> 10.0.254.2/32    0.0.0.0                  0         32768 ?
*= 10.0.254.3/32    172.16.222.2                           0 65002 65200 ?
*>                  172.16.112.2                           0 65001 65200 ?
*= 10.0.254.4/32    172.16.222.2                           0 65002 65200 ?
*>                  172.16.112.2                           0 65001 65200 ?
*> 10.0.254.5/32    172.16.112.2             0             0 65001 ?
*> 10.0.254.6/32    172.16.222.2             0             0 65002 ?
*> 10.0.254.7/32    172.16.112.2                           0 65001 65100 ?
*> 10.0.254.8/32    172.16.222.2                           0 65002 65101 ?
*> 172.16.11.0/30   172.16.112.2             0             0 65001 ?
*> 172.16.22.0/30   172.16.222.2             0             0 65002 ?
*> 172.16.111.0/30  172.16.112.2             0             0 65001 ?
*  172.16.112.0/30  172.16.112.2             0             0 65001 ?
*>                  0.0.0.0                  0         32768 ?
*  172.16.113.0/30  172.16.222.2                           0 65002 65200 ?
*>                  172.16.112.2             0             0 65001 ?
*  172.16.114.0/30  172.16.222.2                           0 65002 65200 ?
*>                  172.16.112.2             0             0 65001 ?
*> 172.16.221.0/30  172.16.222.2             0             0 65002 ?
*  172.16.222.0/30  172.16.222.2             0             0 65002 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.223.0/30  172.16.222.2             0             0 65002 ?
*                   172.16.112.2                           0 65001 65200 ?
*> 172.16.224.0/30  172.16.222.2             0             0 65002 ?
*                   172.16.112.2                           0 65001 65200 ?

Displayed  17 routes and 25 total paths


sudo docker exec -it clab-frrlab4-spine3 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname spine3
no ipv6 forwarding
!
interface eth1
 ip address 172.16.223.1/30
exit
!
interface eth2
 ip address 172.16.113.1/30
exit
!
interface lo
 ip address 10.0.254.3/32
exit
!
router bgp 65200
 bgp router-id 10.0.254.3
 bgp bestpath as-path multipath-relax
 timers bgp 3 9
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC advertisement-interval 0
 neighbor FABRIC timers connect 5
 neighbor eth1 interface peer-group FABRIC
 neighbor eth2 interface peer-group FABRIC
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor FABRIC route-map PERMIT_EBGP in
  neighbor FABRIC route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-spine3 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:00:58
B>* 10.0.254.1/32 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:30
  *                      via 172.16.223.2, eth1, weight 1, 00:00:30
B>* 10.0.254.2/32 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:30
  *                      via 172.16.223.2, eth1, weight 1, 00:00:30
C>* 10.0.254.3/32 is directly connected, lo, 00:00:33
B>* 10.0.254.5/32 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:31
B>* 10.0.254.6/32 [20/0] via 172.16.223.2, eth1, weight 1, 00:00:30
B>* 10.0.254.7/32 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:31
B>* 10.0.254.8/32 [20/0] via 172.16.223.2, eth1, weight 1, 00:00:30
B>* 172.16.11.0/30 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:31
B>* 172.16.22.0/30 [20/0] via 172.16.223.2, eth1, weight 1, 00:00:30
B>* 172.16.111.0/30 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:31
B>* 172.16.112.0/30 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:31
C>* 172.16.113.0/30 is directly connected, eth2, 00:00:33
B>* 172.16.114.0/30 [20/0] via 172.16.113.2, eth2, weight 1, 00:00:31
B>* 172.16.221.0/30 [20/0] via 172.16.223.2, eth1, weight 1, 00:00:30
B>* 172.16.222.0/30 [20/0] via 172.16.223.2, eth1, weight 1, 00:00:30
C>* 172.16.223.0/30 is directly connected, eth1, 00:00:33
B>* 172.16.224.0/30 [20/0] via 172.16.223.2, eth1, weight 1, 00:00:30
C>* 172.20.20.0/24 is directly connected, eth0, 00:00:58


sudo docker exec -it clab-frrlab4-spine3 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=63 time=0.072 ms
64 bytes from 10.0.254.7: seq=1 ttl=63 time=0.062 ms
64 bytes from 10.0.254.7: seq=2 ttl=63 time=0.065 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.062/0.066/0.072 ms

sudo docker exec -it clab-frrlab4-spine3 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=63 time=0.074 ms
64 bytes from 10.0.254.8: seq=1 ttl=63 time=0.064 ms
64 bytes from 10.0.254.8: seq=2 ttl=63 time=0.052 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.052/0.063/0.074 ms




sudo docker exec -it clab-frrlab4-spine3 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  172.16.113.2 (172.16.113.2)  0.003 ms  0.004 ms  0.003 ms
 2  10.0.254.7 (10.0.254.7)  0.002 ms  0.004 ms  0.002 ms

sudo docker exec -it clab-frrlab4-spine3 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  172.16.223.2 (172.16.223.2)  0.005 ms  0.003 ms  0.002 ms
 2  10.0.254.8 (10.0.254.8)  0.002 ms  0.002 ms  0.003 ms




sudo docker exec -it clab-frrlab4-spine3 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.3, local AS number 65200 vrf-id 0
BGP table version 21
RIB entries 33, using 6336 bytes of memory
Peers 2, using 1434 KiB of memory
Peer groups 1, using 64 bytes of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65002        50        49        0    0    0 00:00:35           14       17 N/A
eth2            4      65001        64        50        0    0    0 00:00:36           14       17 N/A

Total number of neighbors 2


sudo docker exec -it clab-frrlab4-spine3 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.223.2, remote AS 65002, local AS 65200, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf2
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.6, local router ID 10.0.254.3
  BGP state = Established, up for 00:00:35
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine3,domain name: n/a) received (name: leaf2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         34
    Keepalives:            12         12
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 49         50
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  14 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:36,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.223.1, Local port: 179
Foreign host: 172.16.223.2, Foreign port: 48970
Nexthop: 172.16.223.1
Nexthop global: fe80::a8c1:abff:fe0e:9a78
Nexthop local: fe80::a8c1:abff:fe0e:9a78
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 1 ms
Read thread: on  Write thread: on  FD used: 25

BGP neighbor on eth2: 172.16.113.2, remote AS 65001, local AS 65200, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf1
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.5, local router ID 10.0.254.3
  BGP state = Established, up for 00:00:36
  Last read 00:00:00, Last write 00:00:00
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine3,domain name: n/a) received (name: leaf1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         47
    Keepalives:            13         13
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 50         64
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  14 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:36,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.113.1, Local port: 179
Foreign host: 172.16.113.2, Foreign port: 40084
Nexthop: 172.16.113.1
Nexthop global: fe80::a8c1:abff:fe89:7822
Nexthop local: fe80::a8c1:abff:fe89:7822
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 2 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-spine3 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 21, local router ID is 10.0.254.3, vrf id 0
Default local pref 100, local AS 65200
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*= 10.0.254.1/32    172.16.223.2                           0 65002 65000 ?
*>                  172.16.113.2                           0 65001 65000 ?
*= 10.0.254.2/32    172.16.223.2                           0 65002 65000 ?
*>                  172.16.113.2                           0 65001 65000 ?
*> 10.0.254.3/32    0.0.0.0                  0         32768 ?
*  10.0.254.5/32    172.16.223.2                           0 65002 65000 65001 ?
*>                  172.16.113.2             0             0 65001 ?
*  10.0.254.6/32    172.16.113.2                           0 65001 65000 65002 ?
*>                  172.16.223.2             0             0 65002 ?
*  10.0.254.7/32    172.16.223.2                           0 65002 65000 65001 65100 ?
*>                  172.16.113.2                           0 65001 65100 ?
*  10.0.254.8/32    172.16.113.2                           0 65001 65000 65002 65101 ?
*>                  172.16.223.2                           0 65002 65101 ?
*  172.16.11.0/30   172.16.223.2                           0 65002 65000 65001 ?
*>                  172.16.113.2             0             0 65001 ?
*  172.16.22.0/30   172.16.113.2                           0 65001 65000 65002 ?
*>                  172.16.223.2             0             0 65002 ?
*  172.16.111.0/30  172.16.223.2                           0 65002 65000 ?
*>                  172.16.113.2             0             0 65001 ?
*  172.16.112.0/30  172.16.223.2                           0 65002 65000 ?
*>                  172.16.113.2             0             0 65001 ?
*  172.16.113.0/30  172.16.113.2             0             0 65001 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.114.0/30  172.16.113.2             0             0 65001 ?
*> 172.16.221.0/30  172.16.223.2             0             0 65002 ?
*                   172.16.113.2                           0 65001 65000 ?
*> 172.16.222.0/30  172.16.223.2             0             0 65002 ?
*                   172.16.113.2                           0 65001 65000 ?
*  172.16.223.0/30  172.16.223.2             0             0 65002 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.224.0/30  172.16.223.2             0             0 65002 ?

Displayed  17 routes and 31 total paths


sudo docker exec -it clab-frrlab4-spine4 vtysh -c "sh run"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Building configuration...

Current configuration:
!
frr version 8.4_git
frr defaults traditional
hostname spine4
no ipv6 forwarding
!
interface eth1
 ip address 172.16.114.1/30
exit
!
interface eth2
 ip address 172.16.224.1/30
exit
!
interface lo
 ip address 10.0.254.4/32
exit
!
router bgp 65200
 bgp router-id 10.0.254.4
 bgp bestpath as-path multipath-relax
 timers bgp 3 9
 neighbor FABRIC peer-group
 neighbor FABRIC remote-as external
 neighbor FABRIC advertisement-interval 0
 neighbor FABRIC timers connect 5
 neighbor eth1 interface peer-group FABRIC
 neighbor eth2 interface peer-group FABRIC
 !
 address-family ipv4 unicast
  redistribute connected route-map ACCEPT_DC_LOCAL
  neighbor FABRIC route-map PERMIT_EBGP in
  neighbor FABRIC route-map PERMIT_EBGP out
 exit-address-family
exit
!
ip prefix-list DC_LOCAL_SUBNET seq 5 permit 172.16.0.0/16 le 32
ip prefix-list DC_LOCAL_SUBNET seq 10 permit 10.0.254.0/24 le 32
!
route-map PERMIT_EBGP permit 10
exit
!
route-map ACCEPT_DC_LOCAL permit 10
 match ip address prefix-list DC_LOCAL_SUBNET
exit
!
end


sudo docker exec -it clab-frrlab4-spine4 vtysh -c "sh ip route"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
Codes: K - kernel route, C - connected, S - static, R - RIP,
       O - OSPF, I - IS-IS, B - BGP, E - EIGRP, N - NHRP,
       T - Table, v - VNC, V - VNC-Direct, A - Babel, F - PBR,
       f - OpenFabric,
       > - selected route, * - FIB route, q - queued, r - rejected, b - backup
       t - trapped, o - offload failure

K>* 0.0.0.0/0 [0/0] via 172.20.20.1, eth0, 00:01:04
B>* 10.0.254.1/32 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:35
  *                      via 172.16.224.2, eth2, weight 1, 00:00:35
B>* 10.0.254.2/32 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:35
  *                      via 172.16.224.2, eth2, weight 1, 00:00:35
C>* 10.0.254.4/32 is directly connected, lo, 00:00:38
B>* 10.0.254.5/32 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:36
B>* 10.0.254.6/32 [20/0] via 172.16.224.2, eth2, weight 1, 00:00:35
B>* 10.0.254.7/32 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:36
B>* 10.0.254.8/32 [20/0] via 172.16.224.2, eth2, weight 1, 00:00:35
B>* 172.16.11.0/30 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:36
B>* 172.16.22.0/30 [20/0] via 172.16.224.2, eth2, weight 1, 00:00:35
B>* 172.16.111.0/30 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:36
B>* 172.16.112.0/30 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:36
B>* 172.16.113.0/30 [20/0] via 172.16.114.2, eth1, weight 1, 00:00:36
C>* 172.16.114.0/30 is directly connected, eth1, 00:00:38
B>* 172.16.221.0/30 [20/0] via 172.16.224.2, eth2, weight 1, 00:00:35
B>* 172.16.222.0/30 [20/0] via 172.16.224.2, eth2, weight 1, 00:00:35
B>* 172.16.223.0/30 [20/0] via 172.16.224.2, eth2, weight 1, 00:00:35
C>* 172.16.224.0/30 is directly connected, eth2, 00:00:38
C>* 172.20.20.0/24 is directly connected, eth0, 00:01:04


sudo docker exec -it clab-frrlab4-spine4 bash -c "ping 10.0.254.7 -c 3"
PING 10.0.254.7 (10.0.254.7): 56 data bytes
64 bytes from 10.0.254.7: seq=0 ttl=63 time=0.079 ms
64 bytes from 10.0.254.7: seq=1 ttl=63 time=0.065 ms
64 bytes from 10.0.254.7: seq=2 ttl=63 time=0.062 ms

--- 10.0.254.7 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.062/0.068/0.079 ms

sudo docker exec -it clab-frrlab4-spine4 bash -c "ping 10.0.254.8 -c 3"
PING 10.0.254.8 (10.0.254.8): 56 data bytes
64 bytes from 10.0.254.8: seq=0 ttl=63 time=0.078 ms
64 bytes from 10.0.254.8: seq=1 ttl=63 time=0.062 ms
64 bytes from 10.0.254.8: seq=2 ttl=63 time=0.061 ms

--- 10.0.254.8 ping statistics ---
3 packets transmitted, 3 packets received, 0% packet loss
round-trip min/avg/max = 0.061/0.067/0.078 ms




sudo docker exec -it clab-frrlab4-spine4 bash -c "traceroute 10.0.254.7"
traceroute to 10.0.254.7 (10.0.254.7), 30 hops max, 46 byte packets
 1  172.16.114.2 (172.16.114.2)  0.004 ms  0.003 ms  0.002 ms
 2  10.0.254.7 (10.0.254.7)  0.002 ms  0.003 ms  0.005 ms

sudo docker exec -it clab-frrlab4-spine4 bash -c "traceroute 10.0.254.8"
traceroute to 10.0.254.8 (10.0.254.8), 30 hops max, 46 byte packets
 1  172.16.224.2 (172.16.224.2)  0.004 ms  0.004 ms  0.002 ms
 2  10.0.254.8 (10.0.254.8)  0.002 ms  0.004 ms  0.002 ms




sudo docker exec -it clab-frrlab4-spine4 vtysh -c "show ip bgp summary"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.

IPv4 Unicast Summary (VRF default):
BGP router identifier 10.0.254.4, local AS number 65200 vrf-id 0
BGP table version 21
RIB entries 33, using 6336 bytes of memory
Peers 2, using 1434 KiB of memory
Peer groups 1, using 64 bytes of memory

Neighbor        V         AS   MsgRcvd   MsgSent   TblVer  InQ OutQ  Up/Down State/PfxRcd   PfxSnt Desc
eth1            4      65001        65        51        0    0    0 00:00:40           14       17 N/A
eth2            4      65002        52        51        0    0    0 00:00:41           14       17 N/A

Total number of neighbors 2


sudo docker exec -it clab-frrlab4-spine4 vtysh -c "show ip bgp neighbors"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP neighbor on eth1: 172.16.114.2, remote AS 65001, local AS 65200, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf1
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.5, local router ID 10.0.254.4
  BGP state = Established, up for 00:00:40
  Last read 00:00:01, Last write 00:00:01
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine4,domain name: n/a) received (name: leaf1,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         47
    Keepalives:            14         14
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 51         65
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  14 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:41,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.114.1, Local port: 179
Foreign host: 172.16.114.2, Foreign port: 33514
Nexthop: 172.16.114.1
Nexthop global: fe80::a8c1:abff:fe18:405f
Nexthop local: fe80::a8c1:abff:fe18:405f
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 2 ms
Read thread: on  Write thread: on  FD used: 25

BGP neighbor on eth2: 172.16.224.2, remote AS 65002, local AS 65200, external link
  Local Role: undefined
  Remote Role: undefined
Hostname: leaf2
 Member of peer-group FABRIC for session parameters
  BGP version 4, remote router ID 10.0.254.6, local router ID 10.0.254.4
  BGP state = Established, up for 00:00:41
  Last read 00:00:02, Last write 00:00:02
  Hold time is 9 seconds, keepalive interval is 3 seconds
  Configured hold time is 9 seconds, keepalive interval is 3 seconds
  Configured conditional advertisements interval is 60 seconds
  Neighbor capabilities:
    4 Byte AS: advertised and received
    Extended Message: advertised and received
    AddPath:
      IPv4 Unicast: RX advertised and received
    Long-lived Graceful Restart: advertised and received
      Address families by peer:
    Route refresh: advertised and received(old & new)
    Enhanced Route Refresh: advertised and received
    Address Family IPv4 Unicast: advertised and received
    Hostname Capability: advertised (name: spine4,domain name: n/a) received (name: leaf2,domain name: n/a)
    Graceful Restart Capability: advertised and received
      Remote Restart timer is 120 seconds
      Address families by peer:
        none
  Graceful restart information:
    End-of-RIB send: IPv4 Unicast
    End-of-RIB received: IPv4 Unicast
    Local GR Mode: Helper*
    Remote GR Mode: Helper
    R bit: True
    N bit: True
    Timers:
      Configured Restart Time(sec): 120
      Received Restart Time(sec): 120
    IPv4 Unicast:
      F bit: False
      End-of-RIB sent: Yes
      End-of-RIB sent after update: No
      End-of-RIB received: Yes
      Timers:
        Configured Stale Path Time(sec): 360
  Message statistics:
    Inq depth is 0
    Outq depth is 0
                         Sent       Rcvd
    Opens:                  1          1
    Notifications:          0          0
    Updates:               33         34
    Keepalives:            14         14
    Route Refresh:          3          3
    Capability:             0          0
    Total:                 51         52
  Minimum time between advertisement runs is 0 seconds

 For address family: IPv4 Unicast
  FABRIC peer-group member
  Update group 1, subgroup 1
  Packet Queue length 0
  Community attribute sent to this neighbor(all)
  Inbound path policy configured
  Outbound path policy configured
  Route map for incoming advertisements is *PERMIT_EBGP
  Route map for outgoing advertisements is *PERMIT_EBGP
  14 accepted prefixes

  Connections established 1; dropped 0
  Last reset 00:00:41,  No AFI/SAFI activated for peer
  External BGP neighbor may be up to 1 hops away.
Local host: 172.16.224.1, Local port: 179
Foreign host: 172.16.224.2, Foreign port: 35644
Nexthop: 172.16.224.1
Nexthop global: fe80::a8c1:abff:fe63:9af4
Nexthop local: fe80::a8c1:abff:fe63:9af4
BGP connection: shared network
BGP Connect Retry Timer in Seconds: 5
Estimated round trip time: 2 ms
Read thread: on  Write thread: on  FD used: 22


sudo docker exec -it clab-frrlab4-spine4 vtysh -c "sh ip bgp"
% Can't open configuration file /etc/frr/vtysh.conf due to 'No such file or directory'.
BGP table version is 21, local router ID is 10.0.254.4, vrf id 0
Default local pref 100, local AS 65200
Status codes:  s suppressed, d damped, h history, * valid, > best, = multipath,
               i internal, r RIB-failure, S Stale, R Removed
Nexthop codes: @NNN nexthop's vrf id, < announce-nh-self
Origin codes:  i - IGP, e - EGP, ? - incomplete
RPKI validation codes: V valid, I invalid, N Not found

   Network          Next Hop            Metric LocPrf Weight Path
*= 10.0.254.1/32    172.16.224.2                           0 65002 65000 ?
*>                  172.16.114.2                           0 65001 65000 ?
*= 10.0.254.2/32    172.16.224.2                           0 65002 65000 ?
*>                  172.16.114.2                           0 65001 65000 ?
*> 10.0.254.4/32    0.0.0.0                  0         32768 ?
*  10.0.254.5/32    172.16.224.2                           0 65002 65000 65001 ?
*>                  172.16.114.2             0             0 65001 ?
*  10.0.254.6/32    172.16.114.2                           0 65001 65000 65002 ?
*>                  172.16.224.2             0             0 65002 ?
*  10.0.254.7/32    172.16.224.2                           0 65002 65000 65001 65100 ?
*>                  172.16.114.2                           0 65001 65100 ?
*  10.0.254.8/32    172.16.114.2                           0 65001 65000 65002 65101 ?
*>                  172.16.224.2                           0 65002 65101 ?
*  172.16.11.0/30   172.16.224.2                           0 65002 65000 65001 ?
*>                  172.16.114.2             0             0 65001 ?
*  172.16.22.0/30   172.16.114.2                           0 65001 65000 65002 ?
*>                  172.16.224.2             0             0 65002 ?
*  172.16.111.0/30  172.16.224.2                           0 65002 65000 ?
*>                  172.16.114.2             0             0 65001 ?
*  172.16.112.0/30  172.16.224.2                           0 65002 65000 ?
*>                  172.16.114.2             0             0 65001 ?
*> 172.16.113.0/30  172.16.114.2             0             0 65001 ?
*  172.16.114.0/30  172.16.114.2             0             0 65001 ?
*>                  0.0.0.0                  0         32768 ?
*> 172.16.221.0/30  172.16.224.2             0             0 65002 ?
*                   172.16.114.2                           0 65001 65000 ?
*> 172.16.222.0/30  172.16.224.2             0             0 65002 ?
*                   172.16.114.2                           0 65001 65000 ?
*> 172.16.223.0/30  172.16.224.2             0             0 65002 ?
*  172.16.224.0/30  172.16.224.2             0             0 65002 ?
*>                  0.0.0.0                  0         32768 ?

Displayed  17 routes and 31 total paths